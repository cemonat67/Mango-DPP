<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HSP Dashboard</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="/static/css/style.css">
    

    
    
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container-fluid">
            <!-- Brand -->
            <a class="navbar-brand" href="/dashboard">
                <div class="brand-icon">
                    <img src="/static/images/logo.png" alt="Zero@Design Logo" class="logo-img">
                </div>
                <div class="brand-text">
                    <div class="brand-title">Zero@Design Dashboard — Eco-Design @ Source</div>
                    <div class="brand-subtitle">Sürdürülebilir tasarım ve karbon ayak izi ölçümü için gelişmiş analitik platform</div>
                </div>
            </a>

            <!-- Primary Navigation -->
            <div class="navbar-nav">
                <ul class="nav-list">
                </ul>

                <!-- Language Selector -->
                <div class="navbar-actions">
                    <div class="lang">
                        <button class="btn btn-ghost">TR</button>
                        <button class="btn btn-ghost">EN</button>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
        
<div class="wrap">
    <!-- Hero Section -->
    <div class="hero">
        <div class="row">
            <div class="seg">
                <button onclick="window.location.href='/'">Dashboard</button>
                <button onclick="window.location.href='/analytics'">Analytics</button>
                <button onclick="window.location.href='/design'">Design</button>
                <button onclick="window.location.href='/analyze'">Analyze</button>
                <button onclick="window.location.href='/optimize'">Optimize</button>
                <button onclick="window.location.href='/report'">Report</button>
                <button onclick="window.location.href='/export'">Export</button>
                <button onclick="window.location.href='/settings/'">Settings</button>
            </div>
        </div>
    </div>
    
    <!-- Additional Navigation Row -->
    <div class="hero">
        <div class="row secondary">
            <div class="seg">
                <button onclick="window.location.href='/benchmark'">Benchmark</button>
                <button onclick="window.location.href='/style_card'">Style Card</button>
                <button onclick="window.location.href='/collection'">Collection</button>
                <button class="active" onclick="window.location.href='/dpp'">DPP/NFT</button>
                <button onclick="window.location.href='/blockchain_status'">Blockchain</button>
            </div>
        </div>
    </div>
</div>

    <!-- Main Content -->
    <div class="container-fluid py-4">
    <!-- DPP Header -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card border-0 shadow-sm">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h2 class="mb-1">
                                <i class="fas fa-passport me-2 text-primary"></i>
                                Digital Product Passport
                            </h2>
                            <p class="text-muted mb-0">Sürdürülebilir moda için şeffaflık ve izlenebilirlik</p>
                        </div>
                        <div class="text-end">
                            <button class="btn btn-primary" onclick="createSampleDPP()">
                                <i class="fas fa-plus me-2"></i>Örnek DPP Oluştur
                            </button>
                            <button class="btn btn-outline-secondary ms-2" onclick="loadDPPList()">
                                <i class="fas fa-refresh me-2"></i>Yenile
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- DPP List -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-white border-bottom">
                    <h5 class="mb-0" style="color: black !important;">
                        <i class="fas fa-list me-2"></i>
                        Kayıtlı DPP'ler
                    </h5>
                </div>
                <div class="card-body">
                    <div id="dppListContainer">
                        <div class="text-center py-4">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">Yükleniyor...</span>
                            </div>
                            <p class="mt-2 text-muted">DPP'ler yükleniyor...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- DPP Detail Modal -->
    <div class="modal fade" id="dppDetailModal" tabindex="-1">
        <div class="modal-dialog modal-xl" style="max-width: 90vw; width: 90vw; margin: 20px auto;">
            <div class="modal-content" style="height: 80vh; max-height: 85vh; overflow: hidden; margin: 0; border-radius: 8px; display: flex; flex-direction: column;">
                <div class="modal-header" style="background-color: #f8f9fa; border-bottom: 1px solid #dee2e6; padding: 12px 20px; margin: 0; flex-shrink: 0; display: flex; justify-content: space-between; align-items: center;">
                    <h5 class="modal-title" style="color: black; font-weight: 600; margin: 0;">
                        <i class="fas fa-passport me-2"></i>
                        DPP Detayları
                    </h5>
                    <button type="button" class="btn btn-outline-danger" data-bs-dismiss="modal" aria-label="Close" onclick="closeDPPModal()" style="padding: 10px 15px; font-size: 20px; font-weight: bold; border: 3px solid #dc3545; color: #dc3545; background-color: white; z-index: 9999; position: relative; min-width: 45px; min-height: 45px; display: flex; align-items: center; justify-content: center; border-radius: 6px;">
                        ✕
                    </button>
                </div>
                <div class="modal-body" style="padding: 15px; overflow-y: auto; background-color: #ffffff; margin: 0; flex: 1;">
                    <div id="dppDetailContent">
                        <!-- DPP detayları buraya yüklenecek -->
                    </div>
                </div>
                <div class="modal-footer" style="background-color: #f8f9fa; border-top: 1px solid #dee2e6; padding: 12px 20px; margin: 0; flex-shrink: 0;">
                    <button type="button" class="btn btn-outline-primary" onclick="downloadDPP()">
                        <i class="fas fa-download me-2"></i>DPP İndir
                    </button>
                    <button type="button" class="btn btn-success" onclick="createNFT()">
                        <i class="fas fa-coins me-2"></i>NFT Oluştur
                    </button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" onclick="closeDPPModal()">Kapat</button>
                </div>
            </div>
        </div>
    </div>

    <!-- NFT Preview Modal -->
    <div class="modal fade" id="nftPreviewModal" tabindex="-1">
        <div class="modal-dialog modal-xl" style="max-width: 90vw; width: 90vw; margin: 20px auto;">
            <div class="modal-content" style="height: 80vh; max-height: 85vh; overflow: hidden; margin: 0; border-radius: 8px; display: flex; flex-direction: column;">
                <div class="modal-header" style="background-color: #f8f9fa; border-bottom: 1px solid #dee2e6; padding: 12px 20px; margin: 0; flex-shrink: 0; display: flex; justify-content: space-between; align-items: center;">
                    <h5 class="modal-title" style="color: black; font-weight: 600; margin: 0;">
                        <i class="fas fa-coins me-2"></i>
                        NFT Önizleme
                    </h5>
                    <button type="button" class="btn btn-outline-danger" data-bs-dismiss="modal" aria-label="Close" onclick="closeNFTModal()" style="padding: 10px 15px; font-size: 20px; font-weight: bold; border: 3px solid #dc3545; color: #dc3545; background-color: white; z-index: 9999; position: relative; min-width: 45px; min-height: 45px; display: flex; align-items: center; justify-content: center; border-radius: 6px;">
                        ✕
                    </button>
                </div>
                <div class="modal-body" style="padding: 15px; overflow-y: auto; background-color: #ffffff; margin: 0; flex: 1;">
                    <div id="nftPreviewContent">
                        <!-- NFT önizleme buraya yüklenecek -->
                    </div>
                </div>
                <div class="modal-footer" style="background-color: #f8f9fa; border-top: 1px solid #dee2e6; padding: 12px 20px; margin: 0; flex-shrink: 0;">
                    <button type="button" class="btn btn-primary" onclick="mintNFT()">
                        <i class="fas fa-hammer me-2"></i>NFT Mint Et
                    </button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" onclick="closeNFTModal()">Kapat</button>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
let currentDPP = null;
let currentNFTMetadata = null;

// Sayfa yüklendiğinde DPP listesini getir
document.addEventListener('DOMContentLoaded', function() {
    loadDPPList();
});

// DPP listesini yükle
async function loadDPPList() {
    const container = document.getElementById('dppListContainer');
    
    // Yükleniyor göstergesi
    container.innerHTML = `
        <div class="text-center py-4">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Yükleniyor...</span>
            </div>
            <p class="mt-2 text-muted">DPP'ler yükleniyor...</p>
        </div>
    `;
    
    try {
        console.log('DPP listesi yükleniyor...');
        const response = await fetch('http://localhost:8001/api/dpp-list');
        
        if (!response.ok) {
            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
        }
        
        const data = await response.json();
        console.log('DPP listesi yanıtı:', data);
        
        if (data.success && data.dpps && data.dpps.length > 0) {
            let html = '<div class="table-responsive">';
            html += '<table class="table table-hover">';
            html += '<thead class="table-light">';
            html += '<tr style="color: black !important;">';
            html += '<th style="color: black !important;">Ürün Adı</th>';
            html += '<th style="color: black !important;">Kategori</th>';
            html += '<th style="color: black !important;">CO₂ Ayak İzi</th>';
            html += '<th style="color: black !important;">Sürdürülebilirlik Skoru</th>';
            html += '<th style="color: black !important;">Oluşturulma Tarihi</th>';
            html += '<th style="color: black !important;">İşlemler</th>';
            html += '</tr>';
            html += '</thead>';
            html += '<tbody>';
            
            data.dpps.forEach(dpp => {
                const date = new Date(dpp.created_at).toLocaleDateString('tr-TR');
                html += `<tr>`;
                html += `<td><strong style="color: white !important;">${dpp.product_name}</strong></td>`;
                html += `<td><span class="badge bg-secondary">${dpp.category}</span></td>`;
                html += `<td><span class="text-danger">${dpp.co2_footprint} kg CO₂</span></td>`;
                html += `<td><span class="badge bg-success">${dpp.sustainability_score}/100</span></td>`;
                html += `<td style="color: white !important;">${date}</td>`;
                html += `<td>`;
                html += `<button class="btn btn-sm btn-outline-primary me-2" onclick="viewDPP('${dpp.dpp_id}')">`;
                html += `<i class="fas fa-eye"></i> Görüntüle`;
                html += `</button>`;
                html += `<button class="btn btn-sm btn-outline-success" onclick="previewNFT('${dpp.dpp_id}')">`;
                html += `<i class="fas fa-coins"></i> NFT`;
                html += `</button>`;
                html += `</td>`;
                html += `</tr>`;
            });
            
            html += '</tbody>';
            html += '</table>';
            html += '</div>';
            
            container.innerHTML = html;
            console.log('DPP listesi başarıyla yüklendi');
        } else {
            container.innerHTML = `
                <div class="text-center py-4">
                    <i class="fas fa-inbox fa-3x text-muted mb-3"></i>
                    <h5 class="text-muted">Henüz DPP oluşturulmamış</h5>
                    <p class="text-muted">Başlamak için bir stil kartından DPP oluşturun</p>
                    <button class="btn btn-primary" onclick="createSampleDPP()">
                        <i class="fas fa-plus me-2"></i>Örnek DPP Oluştur
                    </button>
                </div>
            `;
        }
    } catch (error) {
        console.error('DPP listesi yüklenirken hata:', error);
        container.innerHTML = `
            <div class="alert alert-danger">
                <i class="fas fa-exclamation-triangle me-2"></i>
                <strong>DPP listesi yüklenirken hata oluştu!</strong><br>
                <small>Hata detayı: ${error.message}</small><br>
                <small>API sunucusunun (port 8001) çalıştığından emin olun.</small>
                <br><br>
                <button class="btn btn-outline-danger btn-sm" onclick="loadDPPList()">
                    <i class="fas fa-refresh me-2"></i>Tekrar Dene
                </button>
            </div>
        `;
    }
}

// DPP detaylarını görüntüle
async function viewDPP(dppId) {
    try {
        console.log('DPP detayları yükleniyor:', dppId);
        const response = await fetch(`http://localhost:8001/api/dpp/${dppId}`);
        
        if (!response.ok) {
            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
        }
        
        const data = await response.json();
        console.log('DPP detayları yanıtı:', data);
        
        if (data.success) {
            currentDPP = data.dpp;
            displayDPPDetails(data.dpp);
            new bootstrap.Modal(document.getElementById('dppDetailModal')).show();
        } else {
            console.error('DPP API hatası:', data.error);
            showErrorToast('DPP yüklenirken hata', data.error || 'Bilinmeyen hata');
        }
    } catch (error) {
        console.error('DPP yüklenirken hata:', error);
        showErrorToast('DPP yüklenirken hata oluştu', error.message);
    }
}

// DPP detaylarını göster
function displayDPPDetails(dpp) {
    const container = document.getElementById('dppDetailContent');
    
    let html = `
        <style>
            .dpp-modal-content {
                width: 100%;
                height: 100%;
                margin: 0;
                padding: 0;
                overflow-y: auto;
                overflow-x: hidden;
                box-sizing: border-box;
            }
            .dpp-modal-content .card {
                border: 1px solid #dee2e6;
                border-radius: 4px;
                box-shadow: 0 1px 2px rgba(0,0,0,0.08);
                margin-bottom: 6px;
            }
            .dpp-modal-content .card-header {
                background-color: #f8f9fa;
                border-bottom: 1px solid #dee2e6;
                font-weight: 600;
                color: black !important;
                padding: 4px 8px;
                margin: 0;
            }
            .dpp-modal-content .card-body {
                background-color: white;
                font-size: 12px;
                line-height: 1.3;
                padding: 6px 8px;
                margin: 0;
            }
            .dpp-modal-content .card-body p {
                margin-bottom: 2px;
            }
            .dpp-modal-content .card-body strong {
                font-weight: 600;
                color: black !important;
            }
            .dpp-modal-content .list-unstyled li {
                padding: 0.5px 0;
            }
            .dpp-modal-content canvas {
                 max-height: 200px;
             }
             .dpp-modal-content .badge.bg-secondary {
                 background-color: #6c757d !important;
                 color: white !important;
             }
             .dpp-modal-content .text-danger {
                 color: #dc3545 !important;
             }
             .dpp-modal-content .text-success {
                 color: #198754 !important;
             }
             .dpp-modal-content .fas.fa-check {
                 color: #198754 !important;
             }
             .dpp-modal-content h1, .dpp-modal-content h2, .dpp-modal-content h3, 
             .dpp-modal-content h4, .dpp-modal-content h5, .dpp-modal-content h6 {
                 color: black !important;
                 font-weight: 600;
                 margin: 0 0 2px 0;
             }
             .dpp-modal-content .row {
                 margin: 0;
                 gap: 0;
             }
             .dpp-modal-content .col-md-6 {
                 padding: 0 2px;
             }
             .dpp-modal-content .mb-3 {
                 margin-bottom: 6px !important;
             }
         </style>
        <div class="dpp-modal-content">
            <div class="row">
                <div class="col-md-6">
                    <div class="card mb-3">
                        <div class="card-header">
                            <h6 class="mb-0"><i class="fas fa-info-circle me-2"></i>Ürün Bilgileri</h6>
                        </div>
                        <div class="card-body" style="color: black !important;">
                            <p><strong>DPP ID:</strong> <code>${dpp.dpp_id}</code></p>
                            <p><strong>Ürün Adı:</strong> ${dpp.product_info.name}</p>
                            <p><strong>Kategori:</strong> ${dpp.product_info.category}</p>
                            <p><strong>Marka:</strong> ${dpp.product_info.brand}</p>
                            <p><strong>Sezon:</strong> ${dpp.product_info.season}</p>
                            <p><strong>Koleksiyon:</strong> ${dpp.product_info.collection}</p>
                        </div>
                    </div>
                    
                    <div class="card mb-3">
                        <div class="card-header">
                            <h6 class="mb-0"><i class="fas fa-leaf me-2"></i>Sürdürülebilirlik</h6>
                        </div>
                        <div class="card-body" style="color: black !important;">
                            <p><strong>Toplam CO₂:</strong> <span class="text-danger">${dpp.sustainability.co2_footprint.total_kg} kg</span></p>
                            <p><strong>Sürdürülebilirlik Skoru:</strong> <span class="badge bg-success">${dpp.sustainability.sustainability_score}/100</span></p>
                            <p><strong>Hesaplama Yöntemi:</strong> ${dpp.sustainability.co2_footprint.calculation_method}</p>
                        </div>
                    </div>
                </div>
                
                <div class="col-md-6">
                    <div class="card mb-3">
                        <div class="card-header">
                            <h6 class="mb-0"><i class="fas fa-industry me-2"></i>Malzeme Kompozisyonu</h6>
                        </div>
                        <div class="card-body" style="color: black !important;">
                            <p><strong>Toplam Ağırlık:</strong> ${dpp.materials.total_weight}g</p>
                            <div class="mt-2">
                                <strong>Lif Kompozisyonu:</strong>
                                <ul class="list-unstyled mt-2">
    `;
    
    dpp.materials.fiber_composition.forEach(fiber => {
        html += `<li><span class="badge bg-secondary me-2">${fiber.percentage}%</span>${fiber.fiber}</li>`;
    });
    
    html += `
                            </ul>
                        </div>
                    </div>
                </div>
                
                <div class="card mb-3">
                    <div class="card-header">
                        <h6 class="mb-0"><i class="fas fa-cogs me-2"></i>Üretim Bilgileri</h6>
                    </div>
                    <div class="card-body" style="color: black !important;">
                        <p><strong>Üretim Yeri:</strong> ${dpp.production.manufacturing_location}</p>
                        <p><strong>Üretim Tarihi:</strong> ${dpp.production.production_date}</p>
                        <p><strong>Parti Numarası:</strong> ${dpp.production.batch_number}</p>
                        <div class="mt-2">
                            <strong>İşlemler:</strong>
                            <ul class="list-unstyled mt-2">
    `;
    
    dpp.production.processes.forEach(process => {
        html += `<li><i class="fas fa-check text-success me-2"></i>${process}</li>`;
    });
    
    html += `
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="row">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h6 class="mb-0"><i class="fas fa-chart-pie me-2"></i>CO₂ Dağılımı</h6>
                    </div>
                    <div class="card-body" style="color: black !important; padding: 8px; max-height: 200px; overflow: hidden;">
                        <div style="position: relative; height: 160px; width: 100%; max-width: 100%; overflow: hidden;">
                            <canvas id="dppCO2Chart" style="max-width: 100%; max-height: 100%; width: 100%; height: 100%;"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    `;
    
    container.innerHTML = html;
    
    // CO₂ grafiğini çiz
    setTimeout(() => {
        drawDPPCO2Chart(dpp.sustainability.co2_footprint.breakdown);
    }, 100);
}

// DPP CO₂ grafiğini çiz
function drawDPPCO2Chart(breakdown) {
    const ctx = document.getElementById('dppCO2Chart');
    if (!ctx) {
        console.error('CO2 Chart canvas bulunamadı');
        return;
    }
    
    // Eğer breakdown verisi yoksa veya boşsa, örnek veri kullan
    if (!breakdown || Object.keys(breakdown).length === 0) {
        console.warn('CO2 breakdown verisi bulunamadı, örnek veri kullanılıyor');
        breakdown = {
            'Malzemeler': 5.2,
            'Üretim': 2.1,
            'Taşıma': 1.2,
            'Ambalaj': 0.8
        };
    }
    
    console.log('CO2 Chart çiziliyor:', breakdown);
    
    // Mevcut chart varsa yok et
    if (window.dppCO2ChartInstance) {
        window.dppCO2ChartInstance.destroy();
    }
    
    window.dppCO2ChartInstance = new Chart(ctx, {
        type: 'doughnut',
        data: {
            labels: Object.keys(breakdown),
            datasets: [{
                data: Object.values(breakdown),
                backgroundColor: [
                    '#28a745',
                    '#17a2b8',
                    '#ffc107',
                    '#dc3545',
                    '#6f42c1'
                ],
                borderWidth: 2,
                borderColor: '#fff'
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'bottom',
                    labels: {
                        boxWidth: 10,
                        padding: 8,
                        font: {
                            size: 10
                        },
                        usePointStyle: true
                    }
                },
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            return context.label + ': ' + context.parsed + ' kg CO₂';
                        }
                    }
                }
            },
            layout: {
                padding: 5
            }
        }
    });
}

// NFT önizleme
async function previewNFT(dppId) {
    try {
        console.log('NFT metadata yükleniyor:', dppId);
        const response = await fetch(`http://localhost:8001/api/nft-metadata/${dppId}`);
        
        if (!response.ok) {
            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
        }
        
        const metadata = await response.json();
        console.log('NFT metadata yanıtı:', metadata);
        
        if (!metadata.error) {
            currentNFTMetadata = metadata;
            displayNFTPreview(metadata);
            new bootstrap.Modal(document.getElementById('nftPreviewModal')).show();
        } else {
            console.error('NFT API hatası:', metadata.error);
            showErrorToast('NFT metadata yüklenirken hata', metadata.error || 'Bilinmeyen hata');
        }
    } catch (error) {
        console.error('NFT metadata yüklenirken hata:', error);
        showErrorToast('NFT metadata yüklenirken hata oluştu', error.message);
    }
}

// NFT önizlemesini göster
function displayNFTPreview(metadata) {
    const container = document.getElementById('nftPreviewContent');
    
    let html = `
        <style>
            .nft-modal-content {
                width: 100%;
                height: 100%;
                margin: 0;
                padding: 0;
                overflow-y: auto;
                overflow-x: hidden;
                box-sizing: border-box;
            }
            .nft-modal-content .card {
                border: 1px solid #dee2e6;
                border-radius: 4px;
                box-shadow: 0 1px 2px rgba(0,0,0,0.08);
                margin-bottom: 6px;
            }
            .nft-modal-content .card-header {
                background-color: #f8f9fa;
                border-bottom: 1px solid #dee2e6;
                font-weight: 600;
                color: black !important;
                padding: 4px 8px;
                margin: 0;
            }
            .nft-modal-content .card-body {
                background-color: white;
                font-size: 12px;
                line-height: 1.3;
                padding: 6px 8px;
                margin: 0;
            }
            .nft-modal-content .card-body p {
                margin-bottom: 2px;
            }
            .nft-modal-content .card-body strong {
                font-weight: 600;
                color: black !important;
            }
            .nft-modal-content h1, .nft-modal-content h2, .nft-modal-content h3, 
            .nft-modal-content h4, .nft-modal-content h5, .nft-modal-content h6 {
                color: black !important;
                font-weight: 600;
                margin: 0 0 2px 0;
            }
            .nft-modal-content .row {
                margin: 0;
                gap: 0;
            }
            .nft-modal-content .col-md-6 {
                padding: 0 2px;
            }
            .nft-modal-content .mb-3 {
                margin-bottom: 6px !important;
            }
            .nft-placeholder {
                height: 200px !important;
            }
        </style>
        <div class="nft-modal-content">
            <div class="row">
                <div class="col-md-6">
                    <div class="card mb-3">
                        <div class="card-header">
                            <h6 class="mb-0"><i class="fas fa-image me-2"></i>NFT Görsel</h6>
                        </div>
                        <div class="card-body text-center">
                            <div id="nftImageContainer" class="nft-placeholder bg-light rounded p-4 mb-3" style="display: flex; align-items: center; justify-content: center;">
                                <canvas id="nftCanvas" width="300" height="200" style="max-width: 100%; border-radius: 4px; display: none;"></canvas>
                                <div id="nftPlaceholder">
                                    <i class="fas fa-image fa-3x text-muted mb-2"></i>
                                    <p class="text-muted mb-1">NFT Görseli</p>
                                    <small class="text-muted">Dinamik olarak oluşturulacak</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="col-md-6">
                    <div class="card mb-3">
                        <div class="card-header">
                            <h6 class="mb-0"><i class="fas fa-tags me-2"></i>NFT Metadata</h6>
                        </div>
                        <div class="card-body">
                            <p><strong>İsim:</strong> ${metadata.name}</p>
                            <p><strong>Açıklama:</strong> ${metadata.description}</p>
                            <p><strong>Blockchain:</strong> <span class="badge bg-primary">Polygon</span></p>
                            
                            <div class="mt-2">
                                <strong>Özellikler:</strong>
                                <div class="row mt-1">
    `;
    
    metadata.attributes.forEach(attr => {
        html += `
            <div class="col-6 mb-1">
                <div class="border rounded p-1" style="font-size: 11px;">
                    <small class="text-muted d-block">${attr.trait_type}</small>
                    <strong>${attr.value}</strong>
                </div>
            </div>
        `;
    });
    
    html += `
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    `;
    
    container.innerHTML = html;
    
    // NFT görselini oluştur
    generateNFTImage(metadata);
}

// NFT görseli oluştur
function generateNFTImage(metadata) {
    const canvas = document.getElementById('nftCanvas');
    const ctx = canvas.getContext('2d');
    const placeholder = document.getElementById('nftPlaceholder');
    
    // Canvas boyutları
    canvas.width = 300;
    canvas.height = 200;
    
    // Gradient arka plan
    const gradient = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
    gradient.addColorStop(0, '#667eea');
    gradient.addColorStop(1, '#764ba2');
    ctx.fillStyle = gradient;
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    
    // Üst kısım - Başlık alanı
    ctx.fillStyle = 'rgba(255, 255, 255, 0.9)';
    ctx.fillRect(10, 10, canvas.width - 20, 40);
    
    // Başlık metni
    ctx.fillStyle = '#333';
    ctx.font = 'bold 16px Arial';
    ctx.textAlign = 'center';
    ctx.fillText('NFT Certificate', canvas.width / 2, 35);
    
    // Ürün adı
    ctx.fillStyle = 'white';
    ctx.font = 'bold 20px Arial';
    ctx.textAlign = 'center';
    const productName = metadata.name || 'DPP NFT';
    ctx.fillText(productName, canvas.width / 2, 80);
    
    // Alt bilgi alanı
    ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
    ctx.fillRect(10, canvas.height - 60, canvas.width - 20, 50);
    
    // Blockchain bilgisi
    ctx.fillStyle = '#333';
    ctx.font = '12px Arial';
    ctx.textAlign = 'left';
    ctx.fillText('Blockchain: Polygon', 20, canvas.height - 35);
    
    // Tarih
    const date = new Date().toLocaleDateString('tr-TR');
    ctx.fillText(`Tarih: ${date}`, 20, canvas.height - 20);
    
    // Sağ alt köşede logo/simge
    ctx.fillStyle = '#4CAF50';
    ctx.beginPath();
    ctx.arc(canvas.width - 30, canvas.height - 30, 15, 0, 2 * Math.PI);
    ctx.fill();
    
    ctx.fillStyle = 'white';
    ctx.font = 'bold 12px Arial';
    ctx.textAlign = 'center';
    ctx.fillText('✓', canvas.width - 30, canvas.height - 25);
    
    // Canvas'ı göster, placeholder'ı gizle
    canvas.style.display = 'block';
    placeholder.style.display = 'none';
}

// Örnek DPP oluştur
async function createSampleDPP() {
    const sampleData = {
        product_name: 'Eco T-Shirt',
        product_type: 'T-shirt',
        brand: 'Zero@Design',
        season: 'SS24',
        collection: 'Sustainable Basics',
        total_co2: 8.5,
        co2_breakdown: {
            materials: 5.2,
            production: 2.1,
            transportation: 1.2
        },
        sustainability_score: 85,
        fiber_composition: [
            {fiber: 'Organic Cotton', percentage: 95},
            {fiber: 'Elastane', percentage: 5}
        ],
        weight: 150,
        processes: ['Dyeing', 'Finishing'],
        manufacturing_location: 'Turkey',
        certifications: ['GOTS', 'OEKO-TEX']
    };
    
    try {
        console.log('Örnek DPP oluşturuluyor...', sampleData);
        const response = await fetch('http://localhost:8001/api/create-dpp', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(sampleData)
        });
        
        if (!response.ok) {
            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
        }
        
        const data = await response.json();
        console.log('DPP oluşturma yanıtı:', data);
        
        if (data.success) {
            showSuccessToast('Başarılı!', `Örnek DPP başarıyla oluşturuldu! (ID: ${data.dpp_id})`);
            // DPP listesini yenile
            setTimeout(() => {
                loadDPPList();
            }, 1000);
        } else {
            console.error('DPP API hatası:', data.error);
            showErrorToast('DPP oluşturulurken hata', data.error || 'Bilinmeyen hata');
        }
    } catch (error) {
        console.error('DPP oluşturulurken hata:', error);
        showErrorToast('DPP oluşturulurken hata oluştu', error.message);
    }
}

// DPP indir
function downloadDPP() {
    if (currentDPP) {
        const dataStr = JSON.stringify(currentDPP, null, 2);
        const dataBlob = new Blob([dataStr], {type: 'application/json'});
        const url = URL.createObjectURL(dataBlob);
        const link = document.createElement('a');
        link.href = url;
        link.download = `DPP_${currentDPP.dpp_id}.json`;
        link.click();
        URL.revokeObjectURL(url);
    }
}

// NFT oluştur
function createNFT() {
    if (currentDPP) {
        previewNFT(currentDPP.dpp_id);
        bootstrap.Modal.getInstance(document.getElementById('dppDetailModal')).hide();
    }
}

// NFT mint et (placeholder)
function mintNFT() {
    alert('NFT mint etme özelliği geliştirilme aşamasında. Blockchain entegrasyonu Faz 4\'te tamamlanacak.');
}

// NFT modalını kapat
function closeNFTModal() {
    try {
        const modalElement = document.getElementById('nftPreviewModal');
        if (modalElement) {
            const modal = bootstrap.Modal.getInstance(modalElement) || new bootstrap.Modal(modalElement);
            modal.hide();
        }
    } catch (error) {
        console.error('NFT modal kapatma hatası:', error);
        // Fallback: modalı manuel olarak gizle
        const modalElement = document.getElementById('nftPreviewModal');
        if (modalElement) {
            modalElement.style.display = 'none';
            modalElement.classList.remove('show');
            document.body.classList.remove('modal-open');
            // Backdrop'u kaldır
            const backdrop = document.querySelector('.modal-backdrop');
            if (backdrop) {
                backdrop.remove();
            }
        }
    }
}

// DPP modalını kapat
function closeDPPModal() {
    try {
        const modalElement = document.getElementById('dppDetailModal');
        if (modalElement) {
            const modal = bootstrap.Modal.getInstance(modalElement) || new bootstrap.Modal(modalElement);
            modal.hide();
        }
    } catch (error) {
        console.error('DPP modal kapatma hatası:', error);
        // Fallback: modalı manuel olarak gizle
        const modalElement = document.getElementById('dppDetailModal');
        if (modalElement) {
            modalElement.style.display = 'none';
            modalElement.classList.remove('show');
            document.body.classList.remove('modal-open');
            // Backdrop'u kaldır
            const backdrop = document.querySelector('.modal-backdrop');
            if (backdrop) {
                backdrop.remove();
            }
        }
    }
}

// Hata toast gösterici
function showErrorToast(title, message) {
    // Toast container'ı oluştur (eğer yoksa)
    let toastContainer = document.getElementById('toast-container');
    if (!toastContainer) {
        toastContainer = document.createElement('div');
        toastContainer.id = 'toast-container';
        toastContainer.className = 'toast-container position-fixed top-0 end-0 p-3';
        toastContainer.style.zIndex = '1055';
        document.body.appendChild(toastContainer);
    }
    
    // Toast HTML'i oluştur
    const toastId = 'toast-' + Date.now();
    const toastHTML = `
        <div id="${toastId}" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="toast-header bg-danger text-white">
                <i class="fas fa-exclamation-triangle me-2"></i>
                <strong class="me-auto">${title}</strong>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
            <div class="toast-body">
                ${message}
            </div>
        </div>
    `;
    
    // Toast'ı container'a ekle
    toastContainer.insertAdjacentHTML('beforeend', toastHTML);
    
    // Toast'ı göster
    const toastElement = document.getElementById(toastId);
    const toast = new bootstrap.Toast(toastElement, {
        autohide: true,
        delay: 5000
    });
    toast.show();
    
    // Toast kapandıktan sonra DOM'dan kaldır
    toastElement.addEventListener('hidden.bs.toast', function() {
        toastElement.remove();
    });
}

// Başarı toast gösterici
function showSuccessToast(title, message) {
    // Toast container'ı oluştur (eğer yoksa)
    let toastContainer = document.getElementById('toast-container');
    if (!toastContainer) {
        toastContainer = document.createElement('div');
        toastContainer.id = 'toast-container';
        toastContainer.className = 'toast-container position-fixed top-0 end-0 p-3';
        toastContainer.style.zIndex = '1055';
        document.body.appendChild(toastContainer);
    }
    
    // Toast HTML'i oluştur
    const toastId = 'toast-' + Date.now();
    const toastHTML = `
        <div id="${toastId}" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="toast-header bg-success text-white">
                <i class="fas fa-check-circle me-2"></i>
                <strong class="me-auto">${title}</strong>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
            <div class="toast-body bg-success text-dark" style="color: #000 !important; background-color: #d4edda !important;">
                ${message}
            </div>
        </div>
    `;
    
    // Toast'ı container'a ekle
    toastContainer.insertAdjacentHTML('beforeend', toastHTML);
    
    // Toast'ı göster
    const toastElement = document.getElementById(toastId);
    const toast = new bootstrap.Toast(toastElement, {
        autohide: true,
        delay: 5000
    });
    toast.show();
    
    // Toast kapandıktan sonra DOM'dan kaldır
    toastElement.addEventListener('hidden.bs.toast', function() {
        toastElement.remove();
    });
}

// ESC tuşu ve backdrop click ile modal kapatma
document.addEventListener('DOMContentLoaded', function() {
    // ESC tuşu ile modal kapatma
    document.addEventListener('keydown', function(event) {
        if (event.key === 'Escape') {
            // Açık olan modalları bul ve kapat
            const openModals = document.querySelectorAll('.modal.show');
            openModals.forEach(modal => {
                if (modal.id === 'dppDetailModal') {
                    closeDPPModal();
                } else if (modal.id === 'nftPreviewModal') {
                    closeNFTModal();
                }
            });
        }
    });
    
    // Backdrop click ile modal kapatma
    document.addEventListener('click', function(event) {
        // DPP Modal backdrop click
        const dppModal = document.getElementById('dppDetailModal');
        if (dppModal && event.target === dppModal) {
            closeDPPModal();
        }
        
        // NFT Modal backdrop click
        const nftModal = document.getElementById('nftPreviewModal');
        if (nftModal && event.target === nftModal) {
            closeNFTModal();
        }
    });
});
</script>

    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="container-fluid">
            <div class="footer-content">
                <div class="footer-brand">
                    <i class="fas fa-leaf"></i>
                    <span>Zero@Design</span>
                </div>
                <div class="footer-text">
                    Sürdürülebilir tasarım ve karbon ayak izi ölçümü için gelişmiş analitik platform
                </div>
                <div class="footer-links">
                    <a href="#" class="footer-link">Gizlilik</a>
                    <a href="#" class="footer-link">Şartlar</a>
                    <a href="#" class="footer-link">Destek</a>
                </div>
            </div>
        </div>
    </footer>

    </main>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    
    
</body>
</html>